<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <title>&lt;my-element> Demo</title>
        <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
        <script src="../node_modules/lit/polyfill-support.js"></script>
        <script type="module" src="../build/genspectrum-app.js"></script>
        <script type="module" src="../build/country-filter.js"></script>
        <script type="module" src="../build/prevalence-over-time.js"></script>
    </head>
    <body>
        <genspectrum-app lapis="https://lapis.cov-spectrum.org/open/v1/sample">
            <country-filter country="Switzerland"></country-filter>
            <prevalence-over-time
                numerator='{"country":"Switzerland", "pangoLineage":"B.1.1.7", "dateTo":"2022-01-01"}'
                denominator='{"country":"Switzerland", "dateTo":"2022-01-01"}'
                granularity="month"
                smoothingWindow="0"
            ></prevalence-over-time>
        </genspectrum-app>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                document.querySelector('country-filter').addEventListener('country-changed', (event) => {
                    const sequencesElement = document.querySelector('prevalence-over-time');
                    const oldNumerator = JSON.parse(sequencesElement.getAttribute('numerator'));
                    const oldDenominator = JSON.parse(sequencesElement.getAttribute('denominator'));
                    sequencesElement.setAttribute(
                        'numerator',
                        JSON.stringify({ ...oldNumerator, country: event.detail }),
                    );
                    sequencesElement.setAttribute(
                        'denominator',
                        JSON.stringify({ ...oldDenominator, country: event.detail }),
                    );
                });
            });
        </script>
    </body>
</html>
