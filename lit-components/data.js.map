{"version":3,"file":"data.js","sourceRoot":"","sources":["src/data.ts"],"names":[],"mappings":"AAAA,MAAM,OAAO,WAAW;IAAxB;QACU,UAAK,GAAW,CAAC,CAAA;QACjB,QAAG,GAAG,+CAA+C,CAAC;IAoBhE,CAAC;IAlBC,SAAS;QACP,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC;IACtB,CAAC;IAED,KAAK,CAAC,mBAAmB,CAAC,OAAe,EAAE,MAAmB;QAC5D,MAAM,IAAI,GAGJ,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,mCAAmC,OAAO,EAAE,EAAE,EAAC,MAAM,EAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC;QAC3G,MAAM,KAAK,GAAG,IAAI,GAAG,EAAkB,CAAC;QACxC,KAAK,IAAI,CAAC,IAAI,IAAI,EAAE;YAClB,IAAI,CAAC,CAAC,IAAI,KAAK,IAAI,EAAE;gBACnB,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC;gBAC5C,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;aACnD;SACF;QACD,OAAO,CAAC,GAAG,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC5D,CAAC;CACF;AAED,MAAM,UAAU,oBAAoB;IAClC,aAAa;IACb,IAAI,CAAC,MAAM,CAAC,sBAAsB,EAAE;QAClC,aAAa;QACb,MAAM,CAAC,sBAAsB,GAAG,IAAI,WAAW,EAAE,CAAA;KAClD;IACD,aAAa;IACb,OAAO,MAAM,CAAC,sBAAsB,CAAC;AACvC,CAAC","sourcesContent":["export class DataManager {\r\n  private count: number = 0\r\n  private api = \"https://lapis.cov-spectrum.org/open/v1/sample\";\r\n\r\n  getAndInc() {\r\n    return ++this.count;\r\n  }\r\n\r\n  async getSequencesPerYear(country: string, signal: AbortSignal): Promise<{ year: number, count: number }[]> {\r\n    const data: {\r\n      date: string | null,\r\n      count: number\r\n    }[] = (await (await fetch(`${this.api}/aggregated?fields=date&country=${country}`, {signal})).json()).data;\r\n    const years = new Map<number, number>();\r\n    for (let d of data) {\r\n      if (d.date !== null) {\r\n        const year = new Date(d.date).getFullYear();\r\n        years.set(year, (years.get(year) ?? 0) + d.count);\r\n      }\r\n    }\r\n    return [...years].map(d => ({ year: d[0], count: d[1] }));\r\n  }\r\n}\r\n\r\nexport function getGlobalDataManager(): DataManager {\r\n  // @ts-ignore\r\n  if (!window.genspectrumDataManager) {\r\n    // @ts-ignore\r\n    window.genspectrumDataManager = new DataManager()\r\n  }\r\n  // @ts-ignore\r\n  return window.genspectrumDataManager;\r\n}\r\n"]}