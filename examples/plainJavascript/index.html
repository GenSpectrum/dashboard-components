<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Components Demo</title>
        <script
            type="module"
            src="node_modules/@genspectrum/dashboard-components/dist/components.js"
        ></script>
        <link
            rel="stylesheet"
            href="node_modules/@genspectrum/dashboard-components/dist/style.css"
        />
    </head>
    <body>
        <gs-app lapis="https://lapis.cov-spectrum.org/open/v2/">
            <gs-location-filter
                initialValue="Europe / Switzerland"
                fields='["region", "country", "division", "location"]'
            ></gs-location-filter>
            <gs-date-range-selector
                dateRangeOptions='[{"label":"2020","dateFrom":"2020-01-01","dateTo":"2020-12-31"},{"label":"2021","dateFrom":"2021-01-01","dateTo":"2021-12-31"},{"label":"2022","dateFrom":"2022-01-01","dateTo":"2022-12-31"}]'
                initialValue="2021"
            ></gs-date-range-selector>
            <gs-prevalence-over-time
                numeratorFilter='{"displayName": "My variant","lapisFilter":{"country":"Switzerland", "pangoLineage":"B.1.1.7", "dateTo":"2022-01-01", "dateFrom":"2021-01-01"}}'
                denominatorFilter='{"country":"Switzerland", "dateTo":"2022-01-01", "dateFrom":"2021-01-01"}'
                granularity="day"
                smoothingWindow="7"
                views='["line", "table"]'
            ></gs-prevalence-over-time>
            <gs-prevalence-over-time
                numeratorFilter='{"displayName": "My variant","lapisFilter":{"country":"Switzerland", "pangoLineage":"B.1.1.7", "dateTo":"2022-01-01", "dateFrom":"2021-01-01"}}'
                denominatorFilter='{"country":"Switzerland", "dateTo":"2022-01-01", "dateFrom":"2021-01-01"}'
                granularity="month"
                smoothingWindow="0"
                views='["bar", "table"]'
            ></gs-prevalence-over-time>
        </gs-app>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                document
                    .querySelector("gs-location-filter")
                    .addEventListener("gs-location-changed", (event) => {
                        const sequencesElements = document.querySelectorAll(
                            "gs-prevalence-over-time",
                        );
                        sequencesElements.forEach((element) => {
                            ["numeratorFilter", "denominatorFilter"].forEach((attribute) => {
                                const old = JSON.parse(element.getAttribute(attribute));
                                element.setAttribute(
                                    attribute,
                                    JSON.stringify({ ...old, ...event.detail }),
                                );
                            });
                        });
                    });
                document
                    .querySelector("gs-date-range-selector")
                    .addEventListener("gs-date-range-filter-changed", (event) => {
                        const sequencesElements = document.querySelectorAll(
                            "gs-prevalence-over-time",
                        );
                        sequencesElements.forEach((element) => {
                            ["numeratorFilter", "denominatorFilter"].forEach((attribute) => {
                                const old = JSON.parse(element.getAttribute(attribute));
                                element.setAttribute(
                                    attribute,
                                    JSON.stringify({ ...old, ...event.detail }),
                                );
                            });
                        });
                    });
            });
        </script>
    </body>
</html>
